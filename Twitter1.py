from tweepy import Stream
from tweepy import OAuthHandler
from tweepy.streaming import StreamListener
import mysql.connector
from mysql.connector import errorcode
import json

#Fill in the credentials to store the mined tweets
conn = mysql.connector.connect(user='', password='',
                              host='',
                              database=''
                              )
cursor=conn.cursor()

#Fill in Twitter API Credentials
consumer_key = ""
consumer_secret = ""
access_token = ""
access_token_secret = ""

class listener(StreamListener):

    def on_data(self, data):
        all_data = json.loads(data)
       
        # check to ensure there is text in
        # the json data
        if 'text' in all_data:
          tweet = all_data["text"]
          username = all_data["user"]["screen_name"]
         
         #Fill in database here
          cursor.execute(
            "INSERT INTO cve (,) VALUES (%s,%s)",
            (username, tweet))
         
          conn.commit()
         
          print((username,tweet))
         
          return True
        else:
          return True

    def on_error(self, status):
        print(status)
 
auth = OAuthHandler(consumer_key, consumer_secret)
auth.set_access_token(access_token, access_token_secret)

twitterStream = Stream(auth, listener())
twitterStream.filter(track=["CVE"],
  languages = ["en"], stall_warnings = True)


